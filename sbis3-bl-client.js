// Generated by CoffeeScript 1.8.0
var SBIS3RPCClient, request;

request = require('request');

SBIS3RPCClient = (function() {
  function SBIS3RPCClient(host) {
    this.host = host;
    this.headers = {
      'Content-type': 'application/json; charset=UTF-8'
    };
  }

  SBIS3RPCClient.prototype.callMethod = function(method, path, params) {
    var reqBody, reqOptions;
    if (path == null) {
      path = '';
    }
    reqBody = {
      'jsonrpc': '2.0',
      'protocol': 3,
      'method': method,
      'params': params ? params : {},
      'id': 1
    };
    path = path ? path + '/service/' : path;
    reqOptions = {
      method: 'POST',
      url: this.host + path,
      headers: this.headers,
      body: JSON.stringify(reqBody)
    };
    return new Promise(function(resolve, reject) {
      var serviceRequest;
      return serviceRequest = request(reqOptions, function(err, res, body) {
        return resolve(JSON.parse(arguments[1].body).result);
      });
    });
  };

  SBIS3RPCClient.prototype.auth = function(login, password) {
    var result;
    if (login == null) {
      login = 'admin';
    }
    if (password == null) {
      password = 'admin';
    }
    result = this.callMethod('САП.АутентифицироватьРасш', '/auth', {
      login: login,
      password: password
    });
    return result.then((function(_this) {
      return function(res) {
        var sessionId;
        sessionId = res.d[0][1];
        return _this.headers['X-SBISSessionID'] = sessionId;
      };
    })(this));
  };

  return SBIS3RPCClient;

})();

module.exports = SBIS3RPCClient;
